## 通过muduo网络库以及protobuf实现的分布式rpc网络通信框架

### 环境配置
1. 编译环境：该项目采用Linux+CMake构建
2. 语言：C/C++
3. 所用到的工具：muduo网络库、CMake、Protobuf、ZooKeeper

---

#### RPC通信原理
RPC（Remote Procedure Call Protocol）远程过程调用协议。

- 本项目的rpc框架主要包括以下的两个部分构成：

1. 设计rpc方法参数的打包和解析，也就是数据的序列化和反序列化。使用的protobuf实现。
2. 网络部分：包括寻找rpc服务主机，发起rpc调用请求和响应rpc调用结果，使用muduo网络库和ZooKeeper服务配置中心（专门用于服务发现）


- 框架RpcProvider需要实现的三个功能
1. muduo网络库实现网络的传输功能，实现将请求从远端到达服务端的网络部分；
2. protobuf实现数据的序列化和反序列化，将muduo网络传输过来的请求进行序列化传给服务方法，生成响应后再反序列化给muduo发送出去；
3. 设计一张服务对象与服务方法的映射表，当请求调用框架的时候能够让框架通过查询map表明白调用的是哪个方法。

---


#### muduo网络库编程
muduo网络库的底层采用的Reactor反应堆模型+线程池+epoll实现的，方案特点是one loop per thread，也就是一个main Reactor(主反应堆)负载accept连接，然后把连接分发到某个sub Reactor(工作线程)当中，随后这个连接的所有操作都是在这个sub Reactor所处的线程中完成，多个连接可被分派到多个线程当中以充分利用CPU。

---


#### Protobuf数据序列化和反序列化协议
protobuf（protocol buﬀer）是google 的一种数据交换的格式，它独立于平台语言。

由于它是一种二进制的格式，比使用 xml（20倍） 、json（10倍）进行数据交换快许多。可以把它用
于分布式应用之间的数据通信或者异构环境下的数据交换。作为一种效率和兼容性都很优秀的二进制数
据传输格式，可以用于诸如网络传输、配置文件、数据存储等诸多领域。

---



#### ZooKeeper分布式一致性协调服务应用以及编程
Zookeeper是一个为分布式应用提供一致性协调服务的中间件，在分布式环境中应用非常广泛，它的优秀功能很多，比如分布式环境中全局命名服务，服务注册中心，全局分布式锁等等。

##### ZooKeeper在该项目中提供了什么？
- 文件系统
通过提供一个多层级的节点命名空间（节点名称为znode），与寻常文件系统不同的在于这些节点可以看做是一个树状的目录结构，节点可以设置**关联的数据**。

例如在该项目中就使用了分层目录结构组织服务：
 - 第一层：服务名称（永久节点）如/UserService
 - 第二层：方法名称（临时节点）如/UserService/Login，存储了提供该方法的服务器IP和端口

 Zookeeper的存在实现了服务的动态注册和发现，避免了例如：某个机器donw了后，服务的提供者发生了变化，而客户端并不知情，想要获取最新的服务提供者的URL列表，又必须手工更新配置文件，很不方便的问题。

---


#### 异步日志
主要包括两个部分，一个是异步写日志的日志队列LockQueue，以及通过单例模式实现的日志系统Logger；有一个细节在于日志队列为空的时候可以写日志，不同线程之间用条件变量进行通信，来通知其他线程队列为空，可以进行写日志的操作。




